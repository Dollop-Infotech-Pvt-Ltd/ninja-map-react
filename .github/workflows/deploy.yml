name: Deploy React to Cloudways

on:
  push:
    branches:
      - main  # Update if you want a different deployment branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    env:
      SSH_HOST: ${{ secrets.SSH_HOST }}
      SSH_USERNAME: ${{ secrets.SSH_USERNAME }}
      REMOTE_PATH: ${{ secrets.REMOTE_PATH }}

    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3

    - name: âš™ï¸ Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '22'

    - name: ğŸ“¦ Install dependencies
      run: npm install --legacy-peer-deps

    - name: ğŸ› ï¸ Build React project
      run: npm run build:client

    - name: ğŸ”‘ Setup SSH
      uses: webfactory/ssh-agent@v0.7.0
      with:
        ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

    - name: ğŸ§¹ Clear remote directory
      run: |
        ssh -o StrictHostKeyChecking=no $SSH_USERNAME@$SSH_HOST "rm -rf $REMOTE_PATH/*"

    - name: ğŸš€ Deploy to Cloudways
      run: |
        scp -o StrictHostKeyChecking=no -r dist/spa/* $SSH_USERNAME@$SSH_HOST:$REMOTE_PATH/
