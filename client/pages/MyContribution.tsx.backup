import { useState } from 'react';
import { ChevronDown, MapPin, Building2, MapPinOff, AlertTriangle, Calendar, Info, ArrowLeft, ChevronRight, Utensils, ShoppingBag, Heart, Car, Briefcase, GraduationCap, Plane, Film, Users, MoreHorizontal, X, Image as ImageIcon, Camera, Upload, Clock, Edit2 } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { cn } from '@/lib/utils';
import { useNavigate } from 'react-router-dom';

type ContributionType = 'place' | 'business' | 'fix' | 'activity' | null;
type ActivityType = 'traffic' | 'accident' | 'closure' | 'event' | 'other' | null;
type PlaceType = 'road' | 'landmark' | 'public' | null;
type BusinessType = 'register' | 'claim' | null;
type FixType = 'edit-details' | 'move-pin' | 'correct-name' | null;

const businessCategories = [
  { 
    id: 'food', 
    name: 'Food & Drink', 
    icon: Utensils,
    subcategories: ['Restaurant', 'Fast Food', 'Cafe / Coffee Shop', 'Bakery', 'Street food', 'Bar / Lounge']
  },
  { 
    id: 'retail', 
    name: 'Retail & Shopping', 
    icon: ShoppingBag,
    subcategories: ['Clothing Store', 'Electronics', 'Grocery Store', 'Pharmacy', 'Bookstore', 'Gift Shop']
  },
  { 
    id: 'health', 
    name: 'Health & Wellness', 
    icon: Heart,
    subcategories: ['Hospital', 'Clinic', 'Dental', 'Gym', 'Spa', 'Pharmacy']
  },
  { 
    id: 'automotive', 
    name: 'Automotive & Transport', 
    icon: Car,
    subcategories: ['Car Repair', 'Gas Station', 'Car Wash', 'Parking', 'Auto Parts']
  },
  { 
    id: 'finance', 
    name: 'Finance & Services', 
    icon: Briefcase,
    subcategories: ['Bank', 'ATM', 'Insurance', 'Real Estate', 'Legal Services']
  },
  { 
    id: 'professional', 
    name: 'Professional Services', 
    icon: Briefcase,
    subcategories: ['Consulting', 'Marketing', 'IT Services', 'Accounting', 'Photography']
  },
  { 
    id: 'education', 
    name: 'Education', 
    icon: GraduationCap,
    subcategories: ['School', 'College', 'Training Center', 'Library', 'Tutoring']
  },
  { 
    id: 'travel', 
    name: 'Travel & Hospitality', 
    icon: Plane,
    subcategories: ['Hotel', 'Travel Agency', 'Tourist Attraction', 'Resort']
  },
  { 
    id: 'entertainment', 
    name: 'Entertainment & Lifestyle', 
    icon: Film,
    subcategories: ['Cinema', 'Theater', 'Museum', 'Art Gallery', 'Sports Center']
  },
  { 
    id: 'community', 
    name: 'Public & Community', 
    icon: Users,
    subcategories: ['Government Office', 'Post Office', 'Police Station', 'Fire Station', 'Community Center']
  },
  { 
    id: 'other', 
    name: 'Other', 
    icon: MoreHorizontal,
    subcategories: ['Other']
  }
];

export default function MyContribution() {
  const navigate = useNavigate();
  const [expandedSection, setExpandedSection] = useState<ContributionType>(null);
  const [selectedActivity, setSelectedActivity] = useState<ActivityType>(null);
  const [selectedPlaceType, setSelectedPlaceType] = useState<PlaceType>(null);
  const [selectedBusinessType, setSelectedBusinessType] = useState<BusinessType>(null);
  const [selectedFixType, setSelectedFixType] = useState<FixType>(null);
  const [showCategorySelector, setShowCategorySelector] = useState(false);
  const [expandedCategory, setExpandedCategory] = useState<string | null>(null);
  const [selectedCategory, setSelectedCategory] = useState<string>('');
  const [businessName, setBusinessName] = useState('');
  const [businessStep, setBusinessStep] = useState(1); // 1: profile, 2: location, 3: contact, 4: hours, 5: photos
  const [businessData, setBusinessData] = useState({
    name: '',
    category: '',
    phone: '',
    website: '',
    hours: {} as Record<string, { open: string; close: string; closed: boolean }>,
    photos: [] as string[]
  });
  const [editingDay, setEditingDay] = useState<string | null>(null);
  const [tempHours, setTempHours] = useState({ open: '09:00 AM', close: '05:00 PM', open24: false, closed: false });
  const [showTimePicker, setShowTimePicker] = useState<'open' | 'close' | null>(null);

  const toggleSection = (section: ContributionType) => {
    setExpandedSection(expandedSection === section ? null : section);
    if (section !== 'activity') {
      setSelectedActivity(null);
    }
    if (section !== 'place') {
      setSelectedPlaceType(null);
    }
    if (section !== 'business') {
      setSelectedBusinessType(null);
    }
    if (section !== 'fix') {
      setSelectedFixType(null);
    }
  };

  return (
    <>
      <div className="min-h-screen bg-background flex flex-col">
        {/* Header */}
        <div className="sticky top-0 z-40 border-b border-border/40 bg-background/95 backdrop-blur">
          <div className="container py-4">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4">
                <button
                  onClick={() => navigate(-1)}
                  className="flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors"
                >
                  <ArrowLeft className="h-5 w-5" />
                </button>
                <h1 className="text-xl font-semibold text-foreground">Contribute</h1>
              </div>
              <button className="text-sm text-muted-foreground hover:text-foreground transition-colors">
                Help
              </button>
            </div>
          </div>
        </div>

        {/* Content - Centered and Full Height */}
        <div className="flex-1 flex items-start justify-center py-6 px-4">
        <div className="w-full max-w-3xl space-y-4">
          {/* Welcome Message */}
          <div className="text-center mb-6">
            <h2 className="text-2xl font-bold text-foreground mb-2">Help Improve the Map</h2>
            <p className="text-muted-foreground">Your contributions make our maps better for everyone</p>
          </div>
          {/* Add Missing Place */}
          <div className="panel-green overflow-hidden shadow-lg hover:shadow-xl transition-shadow">
            <button
              onClick={() => toggleSection('place')}
              className="w-full flex items-center justify-between p-5 text-left hover:bg-muted/5 transition-colors"
            >
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-[#036A38]/10 flex items-center justify-center">
                  <MapPin className="h-5 w-5 text-[#036A38]" />
                </div>
                <div>
                  <h3 className="font-medium text-foreground">Add Missing place</h3>
                  <p className="text-sm text-muted-foreground">House, road, landmarks...</p>
                </div>
              </div>
              <ChevronDown
                className={cn(
                  "h-5 w-5 text-muted-foreground transition-transform",
                  expandedSection === 'place' && "rotate-180"
                )}
              />
            </button>
            {expandedSection === 'place' && (
              <div className="animate-slide-up">
                {/* Place Type Options */}
                <div className="border-t border-border/40">
                  {/* Add Road */}
                  <button
                    onClick={() => setSelectedPlaceType(selectedPlaceType === 'road' ? null : 'road')}
                    className="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-muted/5 transition-colors border-b border-border/20"
                  >
                    <div>
                      <h4 className="font-medium text-foreground text-sm">Add Road</h4>
                      <p className="text-xs text-muted-foreground">Missing or new roads/paths..</p>
                    </div>
                    <ChevronRight className="h-4 w-4 text-muted-foreground" />
                  </button>
                  {selectedPlaceType === 'road' && (
                    <div className="px-4 pb-4 pt-2 space-y-3 bg-muted/5">
                      <Input placeholder="Road name" />
                      <Input placeholder="Start location" />
                      <Input placeholder="End location" />
                      <select className="w-full h-12 rounded-xl border border-input bg-background/80 backdrop-blur-sm px-4 py-3 text-sm font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-brand/20 focus:border-brand hover:border-border/80 hover:bg-background/90">
                        <option value="">Road type</option>
                        <option value="highway">Highway</option>
                        <option value="main-road">Main Road</option>
                        <option value="street">Street</option>
                        <option value="path">Path/Trail</option>
                      </select>
                      <textarea
                        className="w-full rounded-xl border border-input bg-background/80 backdrop-blur-sm px-4 py-3 text-sm font-medium transition-all duration-200 placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-brand/20 focus:border-brand hover:border-border/80 hover:bg-background/90 min-h-[80px]"
                        placeholder="Additional details..."
                      />
                      <Button className="w-full bg-[#036A38] hover:bg-[#025C31] text-white">
                        Submit
                      </Button>
                    </div>
                  )}

                  {/* Add Landmark */}
                  <button
                    onClick={() => setSelectedPlaceType(selectedPlaceType === 'landmark' ? null : 'landmark')}
                    className="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-muted/5 transition-colors border-b border-border/20"
                  >
                    <div>
                      <h4 className="font-medium text-foreground text-sm">Add Landmark</h4>
                      <p className="text-xs text-muted-foreground">Parks, monuments, worship centers..</p>
                    </div>
                    <ChevronRight className="h-4 w-4 text-muted-foreground" />
                  </button>
                  {selectedPlaceType === 'landmark' && (
                    <div className="px-4 pb-4 pt-2 space-y-3 bg-muted/5">
                      <Input placeholder="Landmark name" />
                      <Input placeholder="Address/Location" />
                      <select className="w-full h-12 rounded-xl border border-input bg-background/80 backdrop-blur-sm px-4 py-3 text-sm font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-brand/20 focus:border-brand hover:border-border/80 hover:bg-background/90">
                        <option value="">Landmark type</option>
                        <option value="park">Park</option>
                        <option value="monument">Monument</option>
                        <option value="worship">Worship Center</option>
                        <option value="historical">Historical Site</option>
                        <option value="other">Other</option>
                      </select>
                      <textarea
                        className="w-full rounded-xl border border-input bg-background/80 backdrop-blur-sm px-4 py-3 text-sm font-medium transition-all duration-200 placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-brand/20 focus:border-brand hover:border-border/80 hover:bg-background/90 min-h-[80px]"
                        placeholder="Description..."
                      />
                      <Button className="w-full bg-[#036A38] hover:bg-[#025C31] text-white">
                        Submit
                      </Button>
                    </div>
                  )}

                  {/* Add Public Places */}
                  <button
                    onClick={() => setSelectedPlaceType(selectedPlaceType === 'public' ? null : 'public')}
                    className="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-muted/5 transition-colors"
                  >
                    <div>
                      <h4 className="font-medium text-foreground text-sm">Add Public places</h4>
                      <p className="text-xs text-muted-foreground">Hospital, police station, bus stop, govt office..</p>
                    </div>
                    <ChevronRight className="h-4 w-4 text-muted-foreground" />
                  </button>
                  {selectedPlaceType === 'public' && (
                    <div className="px-4 pb-4 pt-2 space-y-3 bg-muted/5">
                      <Input placeholder="Place name" />
                      <Input placeholder="Address" />
                      <select className="w-full h-12 rounded-xl border border-input bg-background/80 backdrop-blur-sm px-4 py-3 text-sm font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-brand/20 focus:border-brand hover:border-border/80 hover:bg-background/90">
                        <option value="">Place type</option>
                        <option value="hospital">Hospital</option>
                        <option value="police">Police Station</option>
                        <option value="bus-stop">Bus Stop</option>
                        <option value="govt-office">Government Office</option>
                        <option value="school">School</option>
                        <option value="post-office">Post Office</option>
                        <option value="other">Other</option>
                      </select>
                      <Input placeholder="Contact number (optional)" />
                      <textarea
                        className="w-full rounded-xl border border-input bg-background/80 backdrop-blur-sm px-4 py-3 text-sm font-medium transition-all duration-200 placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-brand/20 focus:border-brand hover:border-border/80 hover:bg-background/90 min-h-[80px]"
                        placeholder="Additional information..."
                      />
                      <Button className="w-full bg-[#036A38] hover:bg-[#025C31] text-white">
                        Submit
                      </Button>
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>

          {/* Add Business */}
          <div className="panel-green overflow-hidden shadow-lg hover:shadow-xl transition-shadow">
            <button
              onClick={() => toggleSection('business')}
              className="w-full flex items-center justify-between p-5 text-left hover:bg-muted/5 transition-colors"
            >
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-[#036A38]/10 flex items-center justify-center">
                  <Building2 className="h-5 w-5 text-[#036A38]" />
                </div>
                <div>
                  <h3 className="font-medium text-foreground">Add your Business</h3>
                  <p className="text-sm text-muted-foreground">Create a business listing</p>
                </div>
              </div>
              <ChevronDown
                className={cn(
                  "h-5 w-5 text-muted-foreground transition-transform",
                  expandedSection === 'business' && "rotate-180"
                )}
              />
            </button>
            {expandedSection === 'business' && (
              <div className="animate-slide-up">
                {/* Business Type Options */}
                <div className="border-t border-border/40">
                  {/* Register Business */}
                  <button
                    onClick={() => setSelectedBusinessType(selectedBusinessType === 'register' ? null : 'register')}
                    className="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-muted/5 transition-colors border-b border-border/20"
                  >
                    <div>
                      <h4 className="font-medium text-foreground text-sm">Register Business</h4>
                      <p className="text-xs text-muted-foreground">Add a new shop, restaurant, or service to the map</p>
                    </div>
                    <ChevronRight className="h-4 w-4 text-muted-foreground" />
                  </button>
                  {selectedBusinessType === 'register' && (
                    <div className="px-4 pb-4 pt-2 space-y-4 bg-muted/5">
                      {/* Step 1: Business Profile */}
                      {businessStep === 1 && !showCategorySelector && (
                        <>
                          <div className="space-y-2">
                            <h4 className="text-lg font-semibold text-foreground">Make your Business Profile</h4>
                            <p className="text-sm text-muted-foreground">Add your business details to help customers find and trust you</p>
                          </div>
                          
                          <div className="space-y-3">
                            <div>
                              <label className="text-sm text-muted-foreground mb-1 block">Business name</label>
                              <Input 
                                placeholder="Enter business name" 
                                value={businessData.name}
                                onChange={(e) => setBusinessData({...businessData, name: e.target.value})}
                              />
                            </div>
                            
                            <div>
                              <label className="text-sm text-muted-foreground mb-1 block">Business category</label>
                              <button
                                onClick={() => setShowCategorySelector(true)}
                                className="w-full flex items-center justify-between px-4 py-3 rounded-xl border border-input bg-background/80 hover:bg-background/90 transition-all"
                              >
                                <span className={cn(
                                  "text-sm font-medium",
                                  businessData.category ? "text-foreground" : "text-muted-foreground"
                                )}>
                                  {businessData.category || 'Select category'}
                                </span>
                                <ChevronRight className="h-4 w-4 text-muted-foreground" />
                              </button>
                            </div>
                          </div>

                          <div className="pt-2 text-xs text-muted-foreground">
                            By continuing, you agree to the Business Profile{' '}
                            <span className="text-[#036A38] cursor-pointer hover:underline">Terms of Service</span>. 
                            Your business details may be reviewed and published on NINja Map. Read our{' '}
                            <span className="text-[#036A38] cursor-pointer hover:underline">Privacy Policy</span> to 
                            understand how your data is used.
                          </div>

                          <Button 
                            className="w-full bg-[#036A38] hover:bg-[#025C31] text-white"
                            disabled={!businessData.name || !businessData.category}
                            onClick={() => setBusinessStep(2)}
                          >
                            Next
                          </Button>
                        </>
                      )}

                      {/* Category Selector */}
                      {showCategorySelector && (
                        <div className="space-y-3">
                          <div className="flex items-center gap-3 mb-4">
                            <button
                              onClick={() => setShowCategorySelector(false)}
                              className="text-muted-foreground hover:text-foreground"
                            >
                              <ArrowLeft className="h-5 w-5" />
                            </button>
                            <h4 className="text-lg font-semibold text-foreground">Business category</h4>
                          </div>

                          <Input 
                            placeholder="Bakery, Car wash..." 
                            className="mb-2"
                          />

                          <div className="space-y-2 max-h-[400px] overflow-y-auto">
                            {businessCategories.map((category) => {
                              const Icon = category.icon;
                              const isExpanded = expandedCategory === category.id;
                              
                              return (
                                <div key={category.id} className="border border-border/40 rounded-xl overflow-hidden">
                                  <button
                                    onClick={() => setExpandedCategory(isExpanded ? null : category.id)}
                                    className="w-full flex items-center justify-between p-4 hover:bg-muted/5 transition-colors"
                                  >
                                    <div className="flex items-center gap-3">
                                      <Icon className="h-5 w-5 text-[#036A38]" />
                                      <span className="text-sm font-medium text-foreground">{category.name}</span>
                                    </div>
                                    <ChevronDown
                                      className={cn(
                                        "h-4 w-4 text-muted-foreground transition-transform",
                                        isExpanded && "rotate-180"
                                      )}
                                    />
                                  </button>
                                  
                                  {isExpanded && (
                                    <div className="border-t border-border/40 bg-muted/5">
                                      {category.subcategories.map((sub) => (
                                        <button
                                          key={sub}
                                          onClick={() => {
                                            setBusinessData({...businessData, category: sub});
                                            setShowCategorySelector(false);
                                          }}
                                          className="w-full text-left px-4 py-3 text-sm text-foreground hover:bg-muted/10 transition-colors border-b border-border/20 last:border-b-0"
                                        >
                                          {sub}
                                        </button>
                                      ))}
                                    </div>
                                  )}
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      )}

                      {/* Step 2: Place Pin */}
                      {businessStep === 2 && (
                        <>
                          <div className="space-y-2">
                            <h4 className="text-lg font-semibold text-foreground">Place your pin</h4>
                            <p className="text-sm text-muted-foreground">Move your pin location to help customers find your business accurately</p>
                          </div>

                          <div className="relative w-full h-96 bg-muted rounded-xl overflow-hidden border border-border/40">
                            <iframe
                              src="/map"
                              className="w-full h-full border-0"
                              title="Map"
                              style={{ pointerEvents: 'auto' }}
                            />
                          </div>

                          <div className="text-sm text-muted-foreground bg-muted/50 p-3 rounded-lg border border-border/40">
                            <p className="font-medium text-foreground mb-1">Click on the map to set your business location</p>
                            <p className="text-xs">Use the map above to find and mark your exact business location</p>
                          </div>

                          <Button 
                            className="w-full bg-[#036A38] hover:bg-[#025C31] text-white"
                            onClick={() => setBusinessStep(3)}
                          >
                            Next
                          </Button>
                        </>
                      )}

                      {/* Step 3: Contact Details */}
                      {businessStep === 3 && (
                        <>
                          <div className="space-y-2">
                            <h4 className="text-lg font-semibold text-foreground">Contact details</h4>
                            <p className="text-sm text-muted-foreground">Help customers reach your business easily</p>
                          </div>

                          <div className="space-y-3">
                            <div>
                              <label className="text-sm text-muted-foreground mb-1 block">Phone number</label>
                              <div className="flex gap-2">
                                <Input 
                                  placeholder="+234" 
                                  className="w-20"
                                  disabled
                                />
                                <Input 
                                  placeholder="Enter your phone number" 
                                  value={businessData.phone}
                                  onChange={(e) => setBusinessData({...businessData, phone: e.target.value})}
                                  className="flex-1"
                                />
                              </div>
                            </div>

                            <div>
                              <label className="text-sm text-muted-foreground mb-1 block">Website (optional)</label>
                              <Input 
                                placeholder="Enter website" 
                                value={businessData.website}
                                onChange={(e) => setBusinessData({...businessData, website: e.target.value})}
                              />
                            </div>
                          </div>

                          <Button 
                            className="w-full bg-[#036A38] hover:bg-[#025C31] text-white"
                            disabled={!businessData.phone}
                            onClick={() => setBusinessStep(4)}
                          >
                            Next
                          </Button>
                        </>
                      )}

                      {/* Step 4: Business Hours */}
                      {businessStep === 4 && !editingDay && (
                        <>
                          <div className="space-y-2">
                            <h4 className="text-lg font-semibold text-foreground">Business Hours</h4>
                            <p className="text-sm text-muted-foreground">Let customers know when you're open</p>
                          </div>

                          <div className="flex gap-2">
                            <Button 
                              variant="outline"
                              size="sm"
                              className="text-[#036A38] border-[#036A38] hover:bg-[#036A38]/10"
                            >
                              Edit Mon-Sat
                            </Button>
                            <Button 
                              variant="outline"
                              size="sm"
                              className="text-[#036A38] border-[#036A38] hover:bg-[#036A38]/10"
                            >
                              Edit Sunday
                            </Button>
                          </div>

                          <div className="space-y-1">
                            {['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'].map((day) => (
                              <div key={day} className="flex items-center justify-between py-3 px-2 hover:bg-muted/5 rounded-lg transition-colors">
                                <span className="text-sm font-medium text-foreground">{day}</span>
                                <div className="flex items-center gap-3">
                                  <span className="text-sm text-muted-foreground">Closed</span>
                                  <button
                                    onClick={() => setEditingDay(day)}
                                    className="text-muted-foreground hover:text-foreground p-1"
                                  >
                                    <Edit2 className="h-4 w-4" />
                                  </button>
                                </div>
                              </div>
                            ))}
                          </div>

                          <Button 
                            className="w-full bg-[#036A38] hover:bg-[#025C31] text-white mt-4"
                            onClick={() => setBusinessStep(5)}
                          >
                            Next
                          </Button>
                        </>
                      )}

                      {/* Step 5: Business Photos */}
                      {businessStep === 5 && (
                        <>
                          <div className="space-y-2">
                            <h4 className="text-lg font-semibold text-foreground">Business Photos</h4>
                            <p className="text-sm text-muted-foreground">Add photos to help customers recognise and trust your business</p>
                          </div>

                          <div className="grid grid-cols-3 gap-3">
                            <button className="aspect-square rounded-xl border-2 border-dashed border-border hover:border-[#036A38] flex flex-col items-center justify-center gap-2 transition-colors">
                              <ImageIcon className="h-6 w-6 text-[#036A38]" />
                              <span className="text-xs text-muted-foreground">Add Image</span>
                            </button>
                          </div>

                          <Button 
                            className="w-full bg-[#036A38] hover:bg-[#025C31] text-white"
                            onClick={() => {
                              // Submit business
                              setSelectedBusinessType(null);
                              setBusinessStep(1);
                            }}
                          >
                            Review
                          </Button>
                        </>
                      )}
                    </div>
                  )}

                  {/* Claim Your Business */}
                  <button
                    onClick={() => setSelectedBusinessType(selectedBusinessType === 'claim' ? null : 'claim')}
                    className="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-muted/5 transition-colors"
                  >
                    <div>
                      <h4 className="font-medium text-foreground text-sm">Claim Your Business</h4>
                      <p className="text-xs text-muted-foreground">Take ownership of an existing place and manage</p>
                    </div>
                    <ChevronRight className="h-4 w-4 text-muted-foreground" />
                  </button>
                  {selectedBusinessType === 'claim' && (
                    <div className="px-4 pb-4 pt-2 space-y-3 bg-muted/5">
                      <Input placeholder="Business name" />
                      <Input placeholder="Business location/address" />
                      <Input placeholder="Your name" />
                      <Input placeholder="Your contact number" />
                      <Input placeholder="Your email" />
                      <textarea
                        className="w-full rounded-xl border border-input bg-background/80 backdrop-blur-sm px-4 py-3 text-sm font-medium transition-all duration-200 placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-brand/20 focus:border-brand hover:border-border/80 hover:bg-background/90 min-h-[80px]"
                        placeholder="Proof of ownership (describe your relationship to the business)..."
                      />
                      <Button className="w-full bg-[#036A38] hover:bg-[#025C31] text-white">
                        Submit Claim
                      </Button>
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>

          {/* Fix Map */}
          <div className="panel-green overflow-hidden shadow-lg hover:shadow-xl transition-shadow">
            <button
              onClick={() => toggleSection('fix')}
              className="w-full flex items-center justify-between p-5 text-left hover:bg-muted/5 transition-colors"
            >
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-[#036A38]/10 flex items-center justify-center">
                  <MapPinOff className="h-5 w-5 text-[#036A38]" />
                </div>
                <div>
                  <h3 className="font-medium text-foreground">Fix map</h3>
                  <p className="text-sm text-muted-foreground">Names, addresses, routes</p>
                </div>
              </div>
              <ChevronDown
                className={cn(
                  "h-5 w-5 text-muted-foreground transition-transform",
                  expandedSection === 'fix' && "rotate-180"
                )}
              />
            </button>
            {expandedSection === 'fix' && (
              <div className="animate-slide-up">
                {/* Fix Type Options */}
                <div className="border-t border-border/40">
                  {/* Edit Place Details */}
                  <button
                    onClick={() => setSelectedFixType(selectedFixType === 'edit-details' ? null : 'edit-details')}
                    className="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-muted/5 transition-colors border-b border-border/20"
                  >
                    <div>
                      <h4 className="font-medium text-foreground text-sm">Edit Place Details</h4>
                      <p className="text-xs text-muted-foreground">Update wrong names, categories, or addresses.</p>
                    </div>
                    <ChevronRight className="h-4 w-4 text-muted-foreground" />
                  </button>
                  {selectedFixType === 'edit-details' && (
                    <div className="px-4 pb-4 pt-2 space-y-3 bg-muted/5">
                      <Input placeholder="Place name" />
                      <Input placeholder="Current address" />
                      <select className="w-full h-12 rounded-xl border border-input bg-background/80 backdrop-blur-sm px-4 py-3 text-sm font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-brand/20 focus:border-brand hover:border-border/80 hover:bg-background/90">
                        <option value="">What needs to be fixed?</option>
                        <option value="wrong-name">Wrong name</option>
                        <option value="wrong-category">Wrong category</option>
                        <option value="wrong-address">Wrong address</option>
                        <option value="wrong-phone">Wrong phone number</option>
                        <option value="other">Other</option>
                      </select>
                      <Input placeholder="Correct information" />
                      <textarea
                        className="w-full rounded-xl border border-input bg-background/80 backdrop-blur-sm px-4 py-3 text-sm font-medium transition-all duration-200 placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-brand/20 focus:border-brand hover:border-border/80 hover:bg-background/90 min-h-[80px]"
                        placeholder="Additional details..."
                      />
                      <Button className="w-full bg-[#036A38] hover:bg-[#025C31] text-white">
                        Submit
                      </Button>
                    </div>
                  )}

                  {/* Move Place Pin */}
                  <button
                    onClick={() => setSelectedFixType(selectedFixType === 'move-pin' ? null : 'move-pin')}
                    className="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-muted/5 transition-colors border-b border-border/20"
                  >
                    <div>
                      <h4 className="font-medium text-foreground text-sm">Move Place Pin</h4>
                      <p className="text-xs text-muted-foreground">Parks, monuments, worship centers..</p>
                    </div>
                    <ChevronRight className="h-4 w-4 text-muted-foreground" />
                  </button>
                  {selectedFixType === 'move-pin' && (
                    <div className="px-4 pb-4 pt-2 space-y-3 bg-muted/5">
                      <Input placeholder="Place name" />
                      <Input placeholder="Current location (address)" />
                      <Input placeholder="Correct location (address)" />
                      <textarea
                        className="w-full rounded-xl border border-input bg-background/80 backdrop-blur-sm px-4 py-3 text-sm font-medium transition-all duration-200 placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-brand/20 focus:border-brand hover:border-border/80 hover:bg-background/90 min-h-[80px]"
                        placeholder="Explain why the pin location is incorrect..."
                      />
                      <Button className="w-full bg-[#036A38] hover:bg-[#025C31] text-white">
                        Submit
                      </Button>
                    </div>
                  )}

                  {/* Correct Road / Street Name */}
                  <button
                    onClick={() => setSelectedFixType(selectedFixType === 'correct-name' ? null : 'correct-name')}
                    className="w-full flex items-center justify-between px-4 py-4 text-left hover:bg-muted/5 transition-colors"
                  >
                    <div>
                      <h4 className="font-medium text-foreground text-sm">Correct Road / Street Name</h4>
                      <p className="text-xs text-muted-foreground">Hospital, police station, bus stop, govt office..</p>
                    </div>
                    <ChevronRight className="h-4 w-4 text-muted-foreground" />
                  </button>
                  {selectedFixType === 'correct-name' && (
                    <div className="px-4 pb-4 pt-2 space-y-3 bg-muted/5">
                      <Input placeholder="Current road/street name" />
                      <Input placeholder="Correct road/street name" />
                      <Input placeholder="Location/Area" />
                      <textarea
                        className="w-full rounded-xl border border-input bg-background/80 backdrop-blur-sm px-4 py-3 text-sm font-medium transition-all duration-200 placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-brand/20 focus:border-brand hover:border-border/80 hover:bg-background/90 min-h-[80px]"
                        placeholder="Additional information..."
                      />
                      <Button className="w-full bg-[#036A38] hover:bg-[#025C31] text-white">
                        Submit
                      </Button>
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>

          {/* Post/Report Activity */}
          <div className="panel-green overflow-hidden shadow-lg hover:shadow-xl transition-shadow">
            <button
              onClick={() => toggleSection('activity')}
              className="w-full flex items-center justify-between p-5 text-left hover:bg-muted/5 transition-colors"
            >
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-full bg-[#036A38]/10 flex items-center justify-center">
                  <AlertTriangle className="h-5 w-5 text-[#036A38]" />
                </div>
                <div>
                  <h3 className="font-medium text-foreground">Post/ report Activity</h3>
                  <p className="text-sm text-muted-foreground">Traffic, police, accident, events</p>
                </div>
              </div>
              <ChevronDown
                className={cn(
                  "h-5 w-5 text-muted-foreground transition-transform",
                  expandedSection === 'activity' && "rotate-180"
                )}
              />
            </button>
            {expandedSection === 'activity' && (
              <div className="px-4 pb-4 pt-4 space-y-3 animate-slide-up">
                {/* Activity Type Buttons */}
                <div className="grid grid-cols-2 gap-3">
                  <button
                    onClick={() => setSelectedActivity('traffic')}
                    className={cn(
                      "flex flex-col items-center justify-center gap-2 p-4 rounded-2xl border transition-all min-h-[100px]",
                      selectedActivity === 'traffic'
                        ? "bg-[#036A38]/10 border-[#036A38]"
                        : "bg-background/80 border-border hover:bg-muted/5"
                    )}
                  >
                    <div className="w-10 h-10 rounded-full bg-[#036A38]/10 flex items-center justify-center">
                      <AlertTriangle className="h-5 w-5 text-[#036A38]" />
                    </div>
                    <span className="text-sm font-medium text-foreground">Traffic report</span>
                  </button>
                  <button
                    onClick={() => setSelectedActivity('accident')}
                    className={cn(
                      "flex flex-col items-center justify-center gap-2 p-4 rounded-2xl border transition-all min-h-[100px]",
                      selectedActivity === 'accident'
                        ? "bg-[#036A38]/10 border-[#036A38]"
                        : "bg-background/80 border-border hover:bg-muted/5"
                    )}
                  >
                    <div className="w-10 h-10 rounded-full bg-[#036A38]/10 flex items-center justify-center">
                      <AlertTriangle className="h-5 w-5 text-[#036A38]" />
                    </div>
                    <span className="text-sm font-medium text-foreground">Accident</span>
                  </button>
                  <button
                    onClick={() => setSelectedActivity('closure')}
                    className={cn(
                      "flex flex-col items-center justify-center gap-2 p-4 rounded-2xl border transition-all min-h-[100px]",
                      selectedActivity === 'closure'
                        ? "bg-[#036A38]/10 border-[#036A38]"
                        : "bg-background/80 border-border hover:bg-muted/5"
                    )}
                  >
                    <div className="w-10 h-10 rounded-full bg-[#036A38]/10 flex items-center justify-center">
                      <MapPinOff className="h-5 w-5 text-[#036A38]" />
                    </div>
                    <span className="text-sm font-medium text-foreground">Road Closure</span>
                  </button>
                  <button
                    onClick={() => setSelectedActivity('event')}
                    className={cn(
                      "flex flex-col items-center justify-center gap-2 p-4 rounded-2xl border transition-all min-h-[100px]",
                      selectedActivity === 'event'
                        ? "bg-[#036A38]/10 border-[#036A38]"
                        : "bg-background/80 border-border hover:bg-muted/5"
                    )}
                  >
                    <div className="w-10 h-10 rounded-full bg-[#036A38]/10 flex items-center justify-center">
                      <Calendar className="h-5 w-5 text-[#036A38]" />
                    </div>
                    <span className="text-sm font-medium text-foreground">Event</span>
                  </button>
                  <button
                    onClick={() => setSelectedActivity('other')}
                    className={cn(
                      "flex flex-col items-center justify-center gap-2 p-4 rounded-2xl border transition-all min-h-[100px] col-span-2",
                      selectedActivity === 'other'
                        ? "bg-[#036A38]/10 border-[#036A38]"
                        : "bg-background/80 border-border hover:bg-muted/5"
                    )}
                  >
                    <div className="w-10 h-10 rounded-full bg-[#036A38]/10 flex items-center justify-center">
                      <Info className="h-5 w-5 text-[#036A38]" />
                    </div>
                    <span className="text-sm font-medium text-foreground">Other</span>
                  </button>
                </div>

                {/* Activity Form */}
                {selectedActivity && (
                  <div className="space-y-3 animate-fade-in pt-2">
                    <Input placeholder="Location" />
                    <textarea
                      className="w-full rounded-xl border border-input bg-background/80 backdrop-blur-sm px-4 py-3 text-sm font-medium transition-all duration-200 placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-brand/20 focus:border-brand hover:border-border/80 hover:bg-background/90 min-h-[100px]"
                      placeholder="Describe what's happening..."
                    />
                    <Button className="w-full bg-[#036A38] hover:bg-[#025C31] text-white">
                      Submit Report
                    </Button>
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      </div>

      {/* Hours Editor Modal - Rendered at root level */}
      {editingDay && (
        <div className="fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4">
          <div className="w-full max-w-2xl bg-card border border-[#036A38]/30 rounded-2xl p-6 space-y-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div className="flex items-center justify-between mb-2">
              <h4 className="text-lg font-semibold text-foreground">{editingDay}</h4>
              <button 
                onClick={() => {
                  setEditingDay(null);
                  setShowTimePicker(null);
                }}
                className="text-muted-foreground hover:text-foreground transition-colors"
              >
                <X className="h-5 w-5" />
              </button>
            </div>

            <div className="flex gap-2 justify-center mb-3">
              {['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((d, i) => (
                <button
                  key={i}
                  className={cn(
                    "w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium transition-colors",
                    "bg-[#036A38] text-white hover:bg-[#025C31]"
                  )}
                >
                  {d}
                </button>
              ))}
            </div>

            <div className="flex gap-4 items-center justify-center py-2">
              <label className="flex items-center gap-2 cursor-pointer">
                <input 
                  type="checkbox" 
                  className="rounded border-[#036A38] text-[#036A38] focus:ring-[#036A38]"
                  checked={tempHours.open24}
                  onChange={(e) => setTempHours({...tempHours, open24: e.target.checked, closed: false})}
                />
                <span className="text-sm text-foreground">Open 24 hours</span>
              </label>
              <label className="flex items-center gap-2 cursor-pointer">
                <input 
                  type="checkbox" 
                  className="rounded border-[#036A38] text-[#036A38] focus:ring-[#036A38]"
                  checked={tempHours.closed}
                  onChange={(e) => setTempHours({...tempHours, closed: e.target.checked, open24: false})}
                />
                <span className="text-sm text-foreground">Closed</span>
              </label>
            </div>

            {!tempHours.open24 && !tempHours.closed && (
              <div className="grid grid-cols-2 gap-4 py-2">
                <div>
                  <label className="text-sm text-muted-foreground mb-2 block">Opening time</label>
                  <button
                    onClick={() => setShowTimePicker('open')}
                    className="w-full px-4 py-3 rounded-xl border border-[#036A38]/30 bg-background/80 hover:bg-background/90 hover:border-[#036A38] transition-all text-left"
                  >
                    <span className="text-sm font-medium text-foreground">{tempHours.open || '00:00 AM'}</span>
                  </button>
                </div>
                <div>
                  <label className="text-sm text-muted-foreground mb-2 block">Closing time</label>
                  <button
                    onClick={() => setShowTimePicker('close')}
                    className="w-full px-4 py-3 rounded-xl border border-[#036A38]/30 bg-background/80 hover:bg-background/90 hover:border-[#036A38] transition-all text-left"
                  >
                    <span className="text-sm font-medium text-foreground">{tempHours.close || '00:00 PM'}</span>
                  </button>
                </div>
              </div>
            )}

            <div className="flex gap-3 pt-2">
              <Button 
                variant="outline" 
                className="flex-1 border-border/40"
                onClick={() => {
                  setEditingDay(null);
                  setShowTimePicker(null);
                  setTempHours({ open: '09:00 AM', close: '05:00 PM', open24: false, closed: false });
                }}
              >
                Cancel
              </Button>
              <Button 
                className="flex-1 bg-[#036A38] hover:bg-[#025C31] text-white"
                onClick={() => {
                  // Save hours for the day
                  setEditingDay(null);
                  setShowTimePicker(null);
                }}
              >
                Save
              </Button>
            </div>
          </div>
        </div>
      )}

      {/* Time Picker Modal - Rendered at root level */}
      {showTimePicker && (
        <div className="fixed inset-0 bg-black/90 z-[110] flex items-center justify-center p-4">
          <div className="w-full max-w-md bg-card border border-[#036A38]/30 rounded-2xl overflow-hidden shadow-2xl">
            <div className="flex items-center justify-between px-6 py-4 border-b border-border/40 bg-muted/5">
              <button
                onClick={() => {
                  if (showTimePicker === 'open') {
                    setTempHours({...tempHours, open: '09:00 AM'});
                  } else {
                    setTempHours({...tempHours, close: '05:00 PM'});
                  }
                }}
                className="text-[#036A38] font-medium hover:text-[#025C31] transition-colors"
              >
                Reset
              </button>
              <h4 className="text-base font-semibold text-foreground">
                {showTimePicker === 'open' ? 'Opening time' : 'Closing time'}
              </h4>
              <button
                onClick={() => setShowTimePicker(null)}
                className="text-[#036A38] font-medium hover:text-[#025C31] transition-colors"
              >
                Done
              </button>
            </div>

            <div className="relative py-8 px-4 bg-background">
              {/* Selection highlight bar */}
              <div className="absolute left-0 right-0 top-1/2 -translate-y-1/2 h-12 bg-[#036A38]/5 border-y border-[#036A38]/20 pointer-events-none" />
              
              <div className="flex items-center justify-center gap-2">
                {/* Hour Picker */}
                <div className="flex-1 flex flex-col items-center">
                  <div className="h-48 overflow-y-auto scrollbar-hide relative">
                    <div className="flex flex-col items-center py-20">
                      {Array.from({ length: 12 }, (_, i) => {
                        const hour = i + 1;
                        const currentTime = showTimePicker === 'open' ? tempHours.open : tempHours.close;
                        const [currentHour] = currentTime.split(':');
                        const isSelected = parseInt(currentHour) === hour;
                        
                        return (
                          <button
                            key={hour}
                            onClick={() => {
                              const parts = currentTime.split(/[:\s]/);
                              const newTime = `${hour.toString().padStart(2, '0')}:${parts[1]} ${parts[2]}`;
                              if (showTimePicker === 'open') {
                                setTempHours({...tempHours, open: newTime});
                              } else {
                                setTempHours({...tempHours, close: newTime});
                              }
                            }}
                            className={cn(
                              "py-2 px-4 text-2xl font-medium transition-all",
                              isSelected ? "text-foreground scale-110" : "text-muted-foreground/50 scale-90"
                            )}
                          >
                            {hour}
                          </button>
                        );
                      })}
                    </div>
                  </div>
                </div>

                <span className="text-2xl font-bold text-foreground">:</span>

                {/* Minute Picker */}
                <div className="flex-1 flex flex-col items-center">
                  <div className="h-48 overflow-y-auto scrollbar-hide relative">
                    <div className="flex flex-col items-center py-20">
                      {Array.from({ length: 60 }, (_, i) => {
                        const min = i;
                        const currentTime = showTimePicker === 'open' ? tempHours.open : tempHours.close;
                        const parts = currentTime.split(/[:\s]/);
                        const isSelected = parseInt(parts[1]) === min;
                        
                        return (
                          <button
                            key={min}
                            onClick={() => {
                              const timeParts = currentTime.split(/[:\s]/);
                              const newTime = `${timeParts[0]}:${min.toString().padStart(2, '0')} ${timeParts[2]}`;
                              if (showTimePicker === 'open') {
                                setTempHours({...tempHours, open: newTime});
                              } else {
                                setTempHours({...tempHours, close: newTime});
                              }
                            }}
                            className={cn(
                              "py-2 px-4 text-2xl font-medium transition-all",
                              isSelected ? "text-foreground scale-110" : "text-muted-foreground/50 scale-90"
                            )}
                          >
                            {min.toString().padStart(2, '0')}
                          </button>
                        );
                      })}
                    </div>
                  </div>
                </div>

                {/* AM/PM Picker */}
                <div className="flex-1 flex flex-col items-center">
                  <div className="h-48 flex items-center justify-center">
                    <div className="flex flex-col gap-8">
                      {['AM', 'PM'].map((period) => {
                        const currentTime = showTimePicker === 'open' ? tempHours.open : tempHours.close;
                        const currentPeriod = currentTime.split(' ')[1];
                        const isSelected = currentPeriod === period;
                        
                        return (
                          <button
                            key={period}
                            onClick={() => {
                              const timeParts = currentTime.split(/[:\s]/);
                              const newTime = `${timeParts[0]}:${timeParts[1]} ${period}`;
                              if (showTimePicker === 'open') {
                                setTempHours({...tempHours, open: newTime});
                              } else {
                                setTempHours({...tempHours, close: newTime});
                              }
                            }}
                            className={cn(
                              "py-2 px-4 text-2xl font-medium transition-all",
                              isSelected ? "text-foreground scale-110" : "text-muted-foreground/50 scale-90"
                            )}
                          >
                            {period}
                          </button>
                        );
                      })}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </>
  );
}